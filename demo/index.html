<!DOCTYPE html>
<html>
<head>

    <title>DataSand v0.0.1</title>

    <script type="text/javascript">
        var DataSandModule = null;  // Global application object.

        // Indicate load success.
        function moduleDidLoad() {
            DataSandModule = document.getElementById('data_sand');
            DataSandModule.setAttribute('width', window.document.body.scrollWidth + 'px');
            DataSandModule.setAttribute('height', window.document.body.scrollHeight + 'px');
//            DataSandModule.postMessage('Hello');
        }

        // The 'message' event handler.  This handler is fired when the NaCl module
        // posts a message to the browser by calling PPB_Messaging.PostMessage()
        // (in C) or pp::Instance.PostMessage() (in C++).  This implementation
        // simply displays the content of the message in an alert panel.
        function handleMessage(message_event) {
            console.log(message_event.data);
        }
    </script>
</head>
<body style="margin: 0px; padding: 0px">
<div id="listener">
    <script type="text/javascript">
        var listener = document.getElementById('listener');
        listener.addEventListener('load', moduleDidLoad, true);
        listener.addEventListener('message', handleMessage, true);
    </script>

    <embed id="data_sand"
           width=0 height=0
           src="DataSand.nmf"
           type="application/x-pnacl"/>
</div>
<div class="">
    <input type="file" id="file-input">
</div>
<script>
    // Load a csv file
    var onFileLoad = function (e) {
        var csv = e.target.result;
        console.log(csv.length);
        DataSandModule.postMessage(csv);
    }
    var onFileInputChange = function (e) {
        var file = fileInput.files[0];
        var reader = new FileReader();
        reader.onload = onFileLoad;
        reader.readAsText(file);
    }
    var fileInput = document.getElementById('file-input');
    fileInput.addEventListener('change', onFileInputChange);
</script>
</body>
</html>
